3892
4133
2620
Timer unit: 1e-06 s

Total time: 0.000954 s
File: cy_ode.pyx
Function: cy_ode_rhs_single_aop_mkl at line 265

Line #      Hits         Time  Per Hit   % Time  Line Contents
==============================================================
   265                                           cpdef cnp.ndarray[complex, ndim=1, mode="c"] cy_ode_rhs_single_aop_mkl(
   266                                                   double t,
   267                                                   complex[::1] rho,
   268                                                   int nrows,
   269                                                   complex[::1] H0KKpsdata,
   270                                                   int[::1] H0KKpsind,
   271                                                   int[::1] H0KKpsindptr,
   272                                                   complex[::1] Kdata,
   273                                                   int[::1] Kind,
   274                                                   int[::1] Kindptr,
   275                                                   complex[::1] Kpdata,
   276                                                   int[::1] Kpind,
   277                                                   int[::1] Kpindptr):
   278                                           
   279                                               #reshape the 1d rho into 2d rho
   280                                               cdef cnp.ndarray[complex, ndim=1, mode="c"] rho_ndarray = \
   281         1         29.0     29.0      3.0          np.asarray(rho,dtype=complex,order='c')
   282                                               cdef cnp.ndarray[complex, ndim=2, mode="c"] rho2d = \
   283         1         61.0     61.0      6.4          np.ascontiguousarray(rho_ndarray.reshape((nrows,nrows),order='c').T,dtype=complex)
   284                                               #compute the product of -iH0-KKp with rho2d
   285                                               cdef cnp.ndarray[complex, ndim=2, mode="c"] out1 = \
   286         1         16.0     16.0      1.7          np.zeros((nrows,nrows), dtype=complex,order='c')
   287         1        229.0    229.0     24.0      spmm_c_mkl(H0KKpsdata,H0KKpsind,H0KKpsindptr,nrows,nrows,&rho2d[0,0],&out1[0,0])
   288                                               #compute the product rho2d*K in its adjoint form,i.e.,
   289                                               #(rho2d*K).dag()=K*rho2d
   290                                               cdef cnp.ndarray[complex, ndim=2, mode="c"] out2 = \
   291         1         16.0     16.0      1.7          np.zeros((nrows,nrows), dtype=complex,order='c')
   292         1        181.0    181.0     19.0      spmm_c_mkl(Kdata,Kind,Kindptr,nrows,nrows,&rho2d[0,0],&out2[0,0])
   293                                           #    spmmpy_c(Kdata,Kind,Kindptr,rho2d,1.0,out2)
   294                                               ##Calculate Kp*rho2d*K
   295                                               cdef cnp.ndarray[complex, ndim=2, mode="c"] AdjointOut2 = \
   296         1        102.0    102.0     10.7           np.ascontiguousarray(np.transpose(out2).conjugate(),dtype=complex)# out2.T.copy(order='C')
   297         1        185.0    185.0     19.4      spmm_c_mkl(Kpdata,Kpind,Kpindptr,nrows,nrows,&AdjointOut2[0,0],&out1[0,0])
   298                                           #    spmmpy_c(Kpdata,Kpind,Kpindptr,AdjointOut2,1.0,out1)
   299                                               #compute the adjoint of out1 and add it to out1
   300                                               cdef cnp.ndarray[complex, ndim=2, mode="c"] AdjointOut1 = \
   301         1         69.0     69.0      7.2           np.ascontiguousarray(np.transpose(out1).conjugate(),dtype=complex)
   302         1         28.0     28.0      2.9      cdef cnp.ndarray[complex, ndim=2, mode="c"] out3 = out1 + AdjointOut1
   303                                               cdef cnp.ndarray[complex, ndim=1, mode="c"] out4 = \
   304         1         29.0     29.0      3.0          out3.T.reshape(nrows*nrows,order='c')
   305         1          9.0      9.0      0.9      return out4
   306                                           
   307                                           def cy_ode_rhs_single_aop_mkl_sentinel():
   308                                               pass

Timer unit: 1e-06 s

Total time: 0.004454 s
File: cy_ode.pyx
Function: run_cy_ode_rhs_single_aop_mkl at line 445

Line #      Hits         Time  Per Hit   % Time  Line Contents
==============================================================
   445                                           cpdef void run_cy_ode_rhs_single_aop_mkl(
   446                                                   double t,
   447                                                   complex[::1] rho,
   448                                                   int nrows,
   449                                                   complex[::1] H0KKpsdata,
   450                                                   int[::1] H0KKpsind,
   451                                                   int[::1] H0KKpsindptr,
   452                                                   complex[::1] Kdata,
   453                                                   int[::1] Kind,
   454                                                   int[::1] Kindptr,
   455                                                   complex[::1] Kpdata,
   456                                                   int[::1] Kpind,
   457                                                   int[::1] Kpindptr,
   458                                                   int N):
   459         1          1.0      1.0      0.0      cdef size_t ii=0
   460                                               cdef cnp.ndarray[complex, ndim=1, mode="c"] arr
   461         1        887.0    887.0     19.9      arr = cy_ode_rhs_single_aop_mkl(t,rho,nrows,H0KKpsdata,H0KKpsind,H0KKpsindptr,Kdata,Kind,Kindptr,Kpdata,Kpind,Kpindptr)
   462         1        934.0    934.0     21.0      arr = cy_ode_rhs_single_aop_mkl(t,rho,nrows,H0KKpsdata,H0KKpsind,H0KKpsindptr,Kdata,Kind,Kindptr,Kpdata,Kpind,Kpindptr)
   463                                           
   464         1          1.0      1.0      0.0      while ii < N:
   465         3       2627.0    875.7     59.0          arr = cy_ode_rhs_single_aop_mkl(t,rho,nrows,H0KKpsdata,H0KKpsind,H0KKpsindptr,Kdata,Kind,Kindptr,Kpdata,Kpind,Kpindptr)
   466         3          4.0      1.3      0.1          ii += 1
   467                                           
   468                                           def run_cy_ode_rhs_single_aop_mkl_sentinel():
   469                                               pass

Tue Dec  3 20:07:20 2019    Profile.prof

         528583 function calls (528582 primitive calls) in 9.336 seconds

   Ordered by: internal time

   ncalls  tottime  percall  cumtime  percall filename:lineno(function)
     6006    8.389    0.001    8.666    0.001 cy_ode.pyx:194(spmm_c_mkl)
     2002    0.402    0.000    9.330    0.005 cy_ode.pyx:265(cy_ode_rhs_single_aop_mkl)
    32032    0.287    0.000    0.294    0.000 {built-in method numpy.core.multiarray.array}
    62072    0.054    0.000    0.068    0.000 stringsource:344(__cinit__)
    26026    0.041    0.000    0.062    0.000 stringsource:994(memoryview_fromslice)
    30030    0.023    0.000    0.311    0.000 numeric.py:556(ascontiguousarray)
    36046    0.018    0.000    0.067    0.000 stringsource:652(memoryview_cwrapper)
    12012    0.015    0.000    0.033    0.000 stringsource:243(array_cwrapper)
    62072    0.013    0.000    0.013    0.000 stringsource:371(__dealloc__)
    12012    0.013    0.000    0.019    0.000 stringsource:121(__cinit__)
     6006    0.011    0.000    0.011    0.000 cy_ode.pyx:120(to_mkl_matrix)
    62072    0.010    0.000    0.010    0.000 stringsource:297(align_pointer)
    26026    0.007    0.000    0.011    0.000 stringsource:971(__dealloc__)
    26026    0.007    0.000    0.007    0.000 stringsource:513(__getbuffer__)
    12012    0.006    0.000    0.006    0.000 stringsource:1183(fill_contig_strides_array)
     4004    0.006    0.000    0.010    0.000 fromnumeric.py:49(_wrapfunc)
      2/1    0.006    0.003    9.335    9.335 cy_ode.pyx:445(run_cy_ode_rhs_single_aop_mkl)
    12012    0.004    0.000    0.004    0.000 stringsource:1459(format_from_typeinfo)
    12012    0.004    0.000    0.004    0.000 stringsource:184(__getbuffer__)
     4004    0.004    0.000    0.015    0.000 fromnumeric.py:552(transpose)
    36046    0.004    0.000    0.004    0.000 stringsource:658(memoryview_check)
     4004    0.003    0.000    0.003    0.000 {method 'transpose' of 'numpy.ndarray' objects}
    26026    0.003    0.000    0.003    0.000 stringsource:554(__get__)
     2002    0.002    0.000    0.009    0.000 numeric.py:433(asarray)
    12012    0.002    0.000    0.002    0.000 stringsource:210(__dealloc__)
     4004    0.002    0.000    0.002    0.000 {built-in method builtins.getattr}
        1    0.000    0.000    9.336    9.336 {built-in method builtins.exec}
        1    0.000    0.000    9.335    9.335 <string>:1(<module>)
        1    0.000    0.000    0.000    0.000 {method 'disable' of '_lsprof.Profiler' objects}


